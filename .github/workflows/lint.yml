name: Skill Lint

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

env:
  SKILL_PATH: skills/prompt-smith

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Validate SKILL.md exists
        run: test -f ${{ env.SKILL_PATH }}/SKILL.md

      - name: Validate frontmatter
        run: |
          head -20 ${{ env.SKILL_PATH }}/SKILL.md | grep -q "^name:"
          head -20 ${{ env.SKILL_PATH }}/SKILL.md | grep -q "^description:"

      - name: Validate i18n structure
        run: |
          if [ -d "${{ env.SKILL_PATH }}/i18n" ]; then
            for locale in ${{ env.SKILL_PATH }}/i18n/*/; do
              test -f "${locale}SKILL.md"
            done
          fi

      - name: Check required directories
        run: |
          test -d ${{ env.SKILL_PATH }}/onboarding
          test -d ${{ env.SKILL_PATH }}/playbooks
          test -d ${{ env.SKILL_PATH }}/references
          test -d ${{ env.SKILL_PATH }}/templates

      - name: Validate marketplace.json
        run: |
          if [ -f "${{ env.SKILL_PATH }}/marketplace.json" ]; then
            python3 -c "import json; json.load(open('${{ env.SKILL_PATH }}/marketplace.json'))"
          fi
