# Tool Usage 상세 가이드

AI가 사용할 도구와 그 전략을 명확히 정의하는 방법입니다.

> Claude 4.x 7-Point Quality Check의 7번째 항목

---

## 목차

- [개요](#개요)
- [적용 조건](#적용-조건)
- [도구 목록](#도구-목록)
- [실행 전략](#실행-전략)
- [에러 처리](#에러-처리)
- [프롬프트 템플릿](#프롬프트-템플릿)
- [점수 기준](#점수-기준)
- [체크리스트](#체크리스트)
- [안티패턴](#안티패턴)
- [관련 참조](#관련-참조)

---

## 개요

```
┌─────────────────────────────────────────────────────────────┐
│                     TOOL_USAGE                               │
├─────────────────────────────────────────────────────────────┤
│  목적: 도구 사용 지시를 명확하게 정의                        │
│                                                             │
│  핵심 요소:                                                  │
│  1. 사용할 도구 목록                                         │
│  2. 도구 선택 기준                                           │
│  3. 병렬/순차 실행 전략                                      │
│  4. 에러 처리 방법                                           │
└─────────────────────────────────────────────────────────────┘
```

---

## 적용 조건

다음 중 하나라도 해당되면 TOOL_USAGE 적용:

- [ ] 파일 읽기/쓰기 필요
- [ ] 외부 명령 실행 필요 (Bash)
- [ ] 웹 검색/페이지 fetch 필요
- [ ] 외부 API 호출 필요
- [ ] 여러 도구 조합 사용

**해당 없으면 N/A** (점수 계산에서 제외)

---

## 도구 목록

### Claude Code 기본 도구

| 도구 | 용도 | 사용 시점 |
|------|------|----------|
| **Glob** | 파일 패턴 검색 | 파일 목록 필요 시 |
| **Grep** | 내용 검색 | 코드/텍스트 패턴 검색 |
| **Read** | 파일 읽기 | 파일 내용 확인 |
| **Edit** | 파일 수정 | 코드/텍스트 변경 |
| **Write** | 파일 생성 | 새 파일 작성 |
| **Bash** | 명령 실행 | 시스템 명령 필요 시 |
| **WebFetch** | 웹 fetch | URL 내용 필요 시 |
| **WebSearch** | 웹 검색 | 최신 정보 필요 시 |

### 도구 선택 가이드

| 목적 | 권장 도구 | 비권장 |
|------|----------|--------|
| 파일 찾기 | Glob | find (Bash) |
| 내용 검색 | Grep | grep/rg (Bash) |
| 파일 읽기 | Read | cat/head (Bash) |
| 파일 수정 | Edit | sed/awk (Bash) |
| 파일 생성 | Write | echo/cat (Bash) |

---

## 실행 전략

### 병렬 vs 순차 판단

```
┌─────────────────────────────────────────────────────────────┐
│  병렬 실행 조건                                              │
│  ─────────────                                              │
│  • 작업 간 데이터 의존성 없음                                │
│  • 결과가 서로 영향 주지 않음                                │
│  • 순서가 결과에 영향 없음                                   │
│                                                             │
│  예시:                                                       │
│  • 여러 파일 동시 읽기                                       │
│  • 독립적 패턴 검색                                          │
│  • 관련 없는 API 동시 호출                                   │
├─────────────────────────────────────────────────────────────┤
│  순차 실행 조건                                              │
│  ─────────────                                              │
│  • 이전 결과가 다음 입력에 필요                              │
│  • 파일 생성 후 내용 작성                                    │
│  • 검색 후 결과 기반 추가 작업                               │
│                                                             │
│  예시:                                                       │
│  • mkdir → 파일 생성 → 내용 작성                            │
│  • 검색 → 파일 확정 → 내용 읽기 → 수정                      │
│  • 빌드 → 테스트 → 배포                                     │
└─────────────────────────────────────────────────────────────┘
```

### 전략 표현 방법

```markdown
## Tool Usage Strategy

### Parallel Execution
다음 작업들은 동시 실행:
- Glob: `**/*.ts` 파일 목록
- Glob: `**/*.tsx` 파일 목록
- Read: package.json
→ 세 작업은 서로 독립적

### Sequential Execution
다음 작업들은 순차 실행:
1. 검색 결과 → 대상 파일 확정
2. Read로 파일 내용 확인
3. Edit으로 수정
→ 각 단계가 이전 결과에 의존
```

---

## 에러 처리

### 에러 처리 전략

| 전략 | 적용 상황 | 동작 |
|------|----------|------|
| **Skip** | 개별 파일 실패 허용 | 에러 로그 후 다음 진행 |
| **Retry** | 일시적 실패 예상 | N회 재시도 후 실패 처리 |
| **Rollback** | 변경 일관성 필요 | 이전 상태로 복원 |
| **Stop** | 치명적 에러 | 즉시 중단 |

### 에러 처리 템플릿

```markdown
## Error Handling

### Read 실패
- 파일 없음: 스킵, 에러 로그 기록
- 권한 없음: 스킵, 사용자에게 알림

### Edit 실패
- old_string 없음: 파일 다시 읽고 재시도
- 3회 실패: 해당 파일 스킵, 수동 수정 필요 표시

### Bash 실패
- 명령 에러: 에러 메시지 분석, 가능하면 수정
- 타임아웃: 재시도 1회, 실패 시 중단

### 롤백 필요 시
- git stash 또는 이전 커밋으로 복원
```

---

## 프롬프트 템플릿

### 기본 템플릿

```markdown
## Tool Usage

### 사용 도구
- **Glob**: 파일 패턴 검색
- **Read**: 파일 내용 읽기
- **Edit**: 파일 수정
- **Bash**: 명령 실행

### 실행 전략

#### Step 1: 정보 수집 (병렬)
동시 실행:
- Glob: `{{pattern_1}}`
- Glob: `{{pattern_2}}`
- Read: `{{config_file}}`

#### Step 2: 분석 (순차)
Step 1 완료 후:
- 결과 분석
- 대상 파일 확정

#### Step 3: 수정 (순차)
각 파일에 대해:
- Read → 분석 → Edit
- 파일별 순차 처리

#### Step 4: 검증 (순차)
모든 수정 완료 후:
- Bash: `{{verify_command}}`

### 에러 처리
| 도구 | 에러 시 |
|------|--------|
| Read | 스킵, 로그 기록 |
| Edit | 재시도 3회, 실패 시 스킵 |
| Bash | 에러 분석, 가능하면 수정 |

### 도구 선택 기준
| 작업 | 도구 | 이유 |
|------|------|------|
| 파일 찾기 | Glob | 빠르고 안전 |
| 내용 검색 | Grep | 권한 최적화 |
| 파일 수정 | Edit | 안전한 수정 |
```

### 복잡한 태스크 템플릿

```markdown
## Tool Usage

### 도구 목록
| 도구 | 용도 | 조건 |
|------|------|------|
| Glob | 파일 검색 | 패턴 매칭 필요 시 |
| Grep | 내용 검색 | 코드 패턴 찾을 때 |
| Read | 파일 읽기 | 내용 확인 필요 시 |
| Edit | 파일 수정 | 코드 변경 시 |
| Bash | 명령 실행 | 빌드/테스트 시 |

### 실행 흐름

```
       ┌─────────┐
       │  START  │
       └────┬────┘
            │
    ┌───────┴───────┐
    │               │
┌───▼───┐      ┌───▼───┐
│ Glob  │      │ Grep  │  ← 병렬
│ *.ts  │      │pattern│
└───┬───┘      └───┬───┘
    │               │
    └───────┬───────┘
            │
       ┌────▼────┐
       │ Analyze │  ← 순차
       └────┬────┘
            │
       ┌────▼────┐
       │  Loop:  │
       │  Read   │  ← 순차
       │  Edit   │
       └────┬────┘
            │
       ┌────▼────┐
       │  Bash   │  ← 순차
       │  test   │
       └────┬────┘
            │
       ┌────▼────┐
       │   END   │
       └─────────┘
```

### 도구별 규칙

#### Glob
- 패턴: `**/*.{ts,tsx}`
- 제외: `node_modules/`, `dist/`

#### Grep
- 패턴: `{{search_pattern}}`
- 대소문자: 무시 (-i)

#### Read
- 병렬 읽기: 최대 5개 파일 동시
- 큰 파일: offset/limit 사용

#### Edit
- 순차 수정: 파일당 하나씩
- 검증: 수정 후 Read로 확인

#### Bash
- 타임아웃: 120초
- 실패 시: 에러 분석 후 재시도
```

---

## 점수 기준

| 점수 | 기준 |
|------|------|
| **0점** | 도구 지시 없음 (필요한데) |
| **1점** | 부분적 지시 (도구 언급만, 전략 없음) |
| **2점** | 명확한 지시 (도구 + 전략 + 에러 처리) |

---

## 체크리스트

```markdown
## TOOL_USAGE 체크리스트

### 필수
- [ ] 사용할 도구 목록 명시
- [ ] 도구 선택 기준 정의
- [ ] 병렬/순차 실행 전략 명시

### 권장
- [ ] 도구별 에러 처리 정의
- [ ] 도구 결과 활용 방법 명시
- [ ] 실행 흐름 시각화
- [ ] 도구 사용 조건 명시
```

---

## 안티패턴

### 1. 도구 미지정

```markdown
❌ "파일 찾아서 수정해줘"

✅ "Glob으로 **/*.ts 찾고, Read로 확인 후, Edit으로 수정"
```

### 2. 전략 미명시

```markdown
❌ "여러 파일 읽고 수정해"

✅ "Read 병렬로 5개씩 읽고, Edit은 순차로 하나씩"
```

### 3. 에러 처리 없음

```markdown
❌ "grep으로 찾아서 수정"

✅ "Grep으로 검색, 없으면 스킵, Edit 실패 시 재시도 3회"
```

---

## 관련 참조

- [quality-checklist.md](quality-checklist.md) - 7-Point Quality Check
- [claude-4x-best-practices.md](claude-4x-best-practices.md) - Claude 4.x 가이드
- [state-tracking-guide.md](state-tracking-guide.md) - 상태 관리 가이드
